{
with(
loo_compare_object
{
with(
loo_compare_object,
{
plot( elpd_diff, 1:lengt(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
# test
loo_compare_object = ITCJ_loo_compare
model_idx=4:6
nam = attr(loo_compare_object, "dimnames")[[1]]
loo_compare_object = as.data.frame(loo_compare_object)
loo_compare_object$names = nam
loo_compare_object$lower = with( loo_compare_object, elpd_diff - se_diff )
loo_compare_object$upper = with( loo_compare_object, elpd_diff + se_diff )
loo_compare_object = loo_compare_object[order(loo_compare_object$names),]
loo_compare_object = loo_compare_object[model_idx, ]
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
1:length(model_idx)
loo_compare_object
# test
loo_compare_object = ITCJ_loo_compare
model_idx=1:6
nam = attr(loo_compare_object, "dimnames")[[1]]
loo_compare_object = as.data.frame(loo_compare_object)
loo_compare_object$names = nam
loo_compare_object$lower = with( loo_compare_object, elpd_diff - se_diff )
loo_compare_object$upper = with( loo_compare_object, elpd_diff + se_diff )
loo_compare_object = loo_compare_object[order(loo_compare_object$names),]
loo_compare_object = loo_compare_object[model_idx, ]
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
#' model comparison for ITCJ analysis
#'
#' @param loo_compare_object
#'
#' @return plot
#' @export
#'
#' @examples
ITCJ_model_comparison = function( loo_compare_object,
model_idx=1 ){
# # test
# loo_compare_object = ITCJ_loo_compare
# model_idx=1:6
nam = attr(loo_compare_object, "dimnames")[[1]]
loo_compare_object = as.data.frame(loo_compare_object)
loo_compare_object$names = nam
loo_compare_object$lower = with( loo_compare_object, elpd_diff - se_diff )
loo_compare_object$upper = with( loo_compare_object, elpd_diff + se_diff )
loo_compare_object = loo_compare_object[order(loo_compare_object$names),]
loo_compare_object = loo_compare_object[model_idx, ]
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
}
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
png(file=file.path( dir,'3_results','ITCJ_analysis','figures','5_ITCJ_model_comparison.png' ),
width=25, height=20, units='cm', res=200)
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
dev.off()
png(file=file.path( dir,'3_results','ITCJ_analysis','figures','5_ITCJ_model_comparison.png' ),
width=25, height=15, units='cm', res=200)
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
dev.off()
png(file=file.path( dir,'3_results','ITCJ_analysis','figures','5_ITCJ_model_comparison.png' ),
width=25, height=10, units='cm', res=200)
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
dev.off()
# preliminar ####
rm(list=ls()); gc(); old_par=par()
## packages ####
librerias = c('tidyverse','loo')
sapply(librerias, require, character.only=T)
# sapply(librerias, install.packages, character.only=T)
## user defined functions ####
dir = '/home/josema/Desktop/1. Work/1 research/PhD Antwerp/#thesis/paper3/paper3_manuscript'
source( file.path( dir, '1_code', 'udf.R' ) )
# ITCJ model comparisons ####
model_nams = paste0('4_',1:6,'_1_ITCJ_model.stan')
ITCJ_loo_list = vector('list',6)
for( n in 1:length(model_nams) ){
ITCJ_fit = readRDS(
file = file.path(
dir,'3_results','ITCJ_analysis','fit', str_replace(model_nams[n],'.stan','.RDS')) )
ITCJ_loo_list[[n]] = ITCJ_fit$loo()
rm(list=c('ITCJ_fit')); gc()
}
ITCJ_loo_compare = loo_compare( ITCJ_loo_list )
alpha = 0.05
nam = attr(ITCJ_loo_compare, "dimnames")[[1]]
ITCJ_loo_compare = as.data.frame(ITCJ_loo_compare)
ITCJ_loo_compare$names = nam
ITCJ_loo_compare$lower = with( ITCJ_loo_compare, elpd_diff + qnorm(alpha/2)*se_diff )
ITCJ_loo_compare$upper = with( ITCJ_loo_compare, elpd_diff + qnorm(1-alpha/2)*se_diff )
ITCJ_loo_compare = ITCJ_loo_compare[order(ITCJ_loo_compare$names),]
ITCJ_loo_compare
print( ITCJ_loo_compare, simplify=F, digits=2  )
qnorm(alpha/2)
qnorm(1-alpha/2)
write.csv( ITCJ_loo_compare, row.names=T,
file=file.path( dir,'3_results','ITCJ_analysis','fit','5_ITCJ_model_comparison.csv' ) )
ITCJ_loo_compare = loo_compare( ITCJ_loo_list )
alpha = 0.05
nam = attr(ITCJ_loo_compare, "dimnames")[[1]]
ITCJ_loo_compare = as.data.frame(ITCJ_loo_compare)
ITCJ_loo_compare = cbind(nam, ITCJ_loo_compare)
ITCJ_loo_compare$lower = with( ITCJ_loo_compare, elpd_diff + qnorm(alpha/2)*se_diff )
ITCJ_loo_compare$upper = with( ITCJ_loo_compare, elpd_diff + qnorm(1-alpha/2)*se_diff )
ITCJ_loo_compare = ITCJ_loo_compare[order(ITCJ_loo_compare$names),]
ITCJ_loo_compare
ITCJ_loo_compare = loo_compare( ITCJ_loo_list )
alpha = 0.05
nam = attr(ITCJ_loo_compare, "dimnames")[[1]]
ITCJ_loo_compare = as.data.frame(ITCJ_loo_compare)
ITCJ_loo_compare = cbind(names=nam, ITCJ_loo_compare)
ITCJ_loo_compare$lower = with( ITCJ_loo_compare, elpd_diff + qnorm(alpha/2)*se_diff )
ITCJ_loo_compare$upper = with( ITCJ_loo_compare, elpd_diff + qnorm(1-alpha/2)*se_diff )
ITCJ_loo_compare = ITCJ_loo_compare[order(ITCJ_loo_compare$names),]
ITCJ_loo_compare
print( ITCJ_loo_compare, simplify=F, digits=2 )
write.csv( ITCJ_loo_compare, row.names=F,
file=file.path( dir,'3_results','ITCJ_analysis','fit','5_ITCJ_model_comparison.csv' ) )
#' model comparison for ITCJ analysis
#'
#' @param loo_compare_object
#'
#' @return plot
#' @export
#'
#' @examples
ITCJ_model_comparison = function( loo_compare_object,
model_idx=1 ){
# # test
# loo_compare_object = ITCJ_loo_compare
# model_idx=1:6
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
}
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
ITCJ_loo_compare
# test
loo_compare_object = ITCJ_loo_compare
model_idx=1:6
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
# test
loo_compare_object = ITCJ_loo_compare
model_idx=4:6
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names, las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
1:length(model_idx)
min(lower)
1:length(model_idx)
names
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
with(
loo_compare_object,
{
plot( elpd_diff, 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
# axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
# for( i in 1:length(model_idx) ){
#   lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
# }
}
)
elpd_diff
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower), max(upper) ) )
# axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
# for( i in 1:length(model_idx) ){
#   lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
# }
}
)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
# axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
# for( i in 1:length(model_idx) ){
#   lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
# }
}
)
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
# for( i in 1:length(model_idx) ){
#   lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
# }
}
)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
1:length(model_idx)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in model_idx ){
lines( x=c( lower[i], upper[i] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
model_idx
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[model_idx[i]], upper[model_idx[i]] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
# test
loo_compare_object = ITCJ_loo_compare
model_idx=4:6
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[model_idx[i]], upper[model_idx[i]] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
# test
loo_compare_object = ITCJ_loo_compare
model_idx=1:2
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[model_idx[i]], upper[model_idx[i]] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
# test
loo_compare_object = ITCJ_loo_compare
model_idx=c(3,6)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[model_idx[i]], upper[model_idx[i]] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
#' model comparison for ITCJ analysis
#'
#' @param loo_compare_object
#'
#' @return plot
#' @export
#'
#' @examples
ITCJ_model_comparison = function( loo_compare_object,
model_idx=1 ){
# # test
# loo_compare_object = ITCJ_loo_compare
# model_idx=c(3,6)
with(
loo_compare_object,
{
plot( elpd_diff[model_idx], 1:length(model_idx), pch=19, col=rgb(0,0,1,0.5),
xlab='PSIS difference', ylab='', yaxt='n',
xlim=c( min(lower[model_idx]), max(upper[model_idx]) ) )
axis( side=2, at=1:length(model_idx), labels=names[model_idx], las=2)
for( i in 1:length(model_idx) ){
lines( x=c( lower[model_idx[i]], upper[model_idx[i]] ), y=rep(i,2), col=rgb(0,0,1,0.5))
}
}
)
}
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
dev.off()
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
# preliminar ####
rm(list=ls()); gc(); old_par=par()
## packages ####
librerias = c('tidyverse','loo')
sapply(librerias, require, character.only=T)
# sapply(librerias, install.packages, character.only=T)
## user defined functions ####
dir = '/home/josema/Desktop/1. Work/1 research/PhD Antwerp/#thesis/paper3/paper3_manuscript'
source( file.path( dir, '1_code', 'udf.R' ) )
# ITCJ model comparisons ####
model_nams = paste0('4_',1:6,'_1_ITCJ_model.stan')
ITCJ_loo_list = vector('list',6)
for( n in 1:length(model_nams) ){
ITCJ_fit = readRDS(
file = file.path(
dir,'3_results','ITCJ_analysis','fit', str_replace(model_nams[n],'.stan','.RDS')) )
ITCJ_loo_list[[n]] = ITCJ_fit$loo()
rm(list=c('ITCJ_fit')); gc()
}
ITCJ_loo_compare = loo_compare( ITCJ_loo_list )
alpha = 0.05
nam = attr(ITCJ_loo_compare, "dimnames")[[1]]
ITCJ_loo_compare = as.data.frame(ITCJ_loo_compare)
ITCJ_loo_compare = cbind(names=nam, ITCJ_loo_compare)
ITCJ_loo_compare$lower = with( ITCJ_loo_compare, elpd_diff + qnorm(alpha/2)*se_diff )
ITCJ_loo_compare$upper = with( ITCJ_loo_compare, elpd_diff + qnorm(1-alpha/2)*se_diff )
ITCJ_loo_compare = ITCJ_loo_compare[order(ITCJ_loo_compare$names),]
print( ITCJ_loo_compare, simplify=F, digits=2 )
# View(ITCJ_loo_compare)
write.csv( ITCJ_loo_compare, row.names=F,
file=file.path( dir,'3_results','ITCJ_analysis','fit','5_ITCJ_model_comparison.csv' ) )
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
png(file=file.path( dir,'3_results','ITCJ_analysis','figures','5_ITCJ_model_comparison.png' ),
width=25, height=10, units='cm', res=200)
par(mfrow=c(1,2))
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 1:6 )
ITCJ_model_comparison( loo_compare_object=ITCJ_loo_compare,
model_idx = 4:6 )
par(mfrow=c(1,1))
dev.off()
# preliminar ####
rm(list=ls()); gc(); old_par=par()
## packages ####
# linux: sudo apt-get install -y libmagick++-dev
# R: install.packages('magick')
librerias = c('magick','tidyverse')
sapply(librerias, require, character.only=T)
## dir ####
dir = '/home/josema/Desktop/1. Work/1 research/PhD Antwerp/#thesis/paper3/paper3_presentation/figures'
idx = str_detect(filenames, '5_ITCJ_model_comparison')
filenames[idx]
filenames = list.files( path=file.path(dir, 'ITCJ_analysis', 'cropped'), full.names=T)
idx = str_detect(filenames, '5_ITCJ_model_comparison')
idx
filenames[idx]
# manual
img = image_read( path=filenames[idx] )
print(img)
image_crop( geometry=geometry_area(width=1770, height=1350, x_off=140, y_off=180),
image=img )
# manual
img = image_read( path=filenames[idx] )
print(img)
image_crop( geometry=geometry_area(width=1830, height=1000, x_off=70, y_off=130),
image=img )
